<!--
========================================================================
ECHO LANDING PAGE - KILLER WHALE VENTURES (KWV)
ANGLE DESK SYSTEM - MULTI-BRAND SPLIT-TEST SYSTEM
========================================================================

This is the KWV-branded version with all new features from master v2.1

BRAND CUSTOMIZATION COMPLETE:
- KWV green accent (#1DBF8A)
- KWV default content
- KWV footer links
- KWV social proof customization

URL PARAMETERS:

Content:
  ?hl=           Headline text
  ?sh=           Subheadline text
  ?cta=          Button text
  ?img=          Image filename
  ?link=         Destination URL

Styles:
  ?font=         system|roboto|inter|poppins|arial|georgia
  ?btn_color=    Button color (hex, no #)
  ?btn_text=     Button text color (hex, no #)
  ?btn_size=     small|medium|large|xlarge
  ?btn_style=    square|rounded|pill|subtle
  ?hl_size=      Headline size (px)
  ?sh_size=      Subheadline size (px)
  ?hl_color=     Headline color (hex, no #)
  ?sh_color=     Subheadline color (hex, no #)
  ?overlay=      light|medium|dark|xdark
  ?overlay_custom= 0.0-1.0 (opacity)

Psychological Triggers:
  ?social_proof=on      Enable social proof ticker
  ?social_text=         Override with custom static message
  ?scarcity=N           Enable scarcity (N = number)
  ?scarcity_text=       Override with custom message
  ?progress=N           Show progress (Step N of 3)
  ?micro_yes=on         Enable micro-commitment checkbox
  ?micro_text=          Override checkbox label

Testing:
  ?test_all=1    Enable ALL features instantly (social+scarcity+progress+micro+debug)
  ?debug=1       Enable console logging only

Mobile:
  Auto-detects mobile (‚â§768px) and loads [filename]_mobile.[ext] if exists

========================================================================
-->
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T639H2SD');</script>
<!-- End Google Tag Manager -->

<style>
  :root {
    --kw-bg-overlay: rgba(0, 0, 0, 0.55);
    --kw-text: #ffffff;
    --kw-accent: #1DBF8A;        /* KWV Brand Green */
    --kw-accent-text: #0b0f14;   /* KWV Dark Text */
    --kw-font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", Helvetica, sans-serif;
  }

  #echo-root {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: column;
    font-family: var(--kw-font);
    color: var(--kw-text);
    z-index: 1000;
    pointer-events: none;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }

  #echo-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--kw-bg-overlay);
    z-index: 1;
    pointer-events: none;
  }

  #echo-content {
    position: relative;
    z-index: 2;
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 22px;
    width: 100%;
    max-width: 720px;
    margin: 0 auto;
    text-align: center;
    pointer-events: auto;
  }

  #hl {
    margin: 0 0 14px;
    font-size: 38px;
    line-height: 1.08;
    font-weight: 800;
    letter-spacing: -0.02em;
  }

  #sh {
    margin: 0 0 22px;
    font-size: 18px;
    line-height: 1.45;
    opacity: 0.95;
  }

  #cta {
    display: inline-block;
    padding: 16px 26px;
    background: var(--kw-accent);
    color: var(--kw-accent-text);
    text-decoration: none;
    font-size: 18px;
    border-radius: 12px;
    font-weight: 900;
    box-shadow: 0 12px 26px rgba(0, 0, 0, 0.35);
    transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.3s ease;
  }

  #cta:hover {
    transform: translateY(-2px);
    box-shadow: 0 16px 32px rgba(0, 0, 0, 0.45);
  }

  #cta:active {
    transform: translateY(0px);
  }

  #cta.dimmed {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }

  #echo-footer {
    position: relative;
    z-index: 2;
    width: 100%;
    padding: 14px 20px;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    pointer-events: auto;
    font-size: 12px;
    color: rgba(255, 255, 255, 0.8);
  }

  #footer-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
  }

  #footer-copyright {
    margin: 0;
  }

  #footer-links {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }

  #footer-links a {
    color: rgba(255, 255, 255, 0.9);
    text-decoration: none;
    transition: color 0.2s;
  }

  #footer-links a:hover {
    color: #ffffff;
  }

  /* ==============================================
     PSYCHOLOGICAL TRIGGERS (Optional via URL)
     ============================================== */

  #micro-yes-container {
    display: none;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    user-select: none;
    padding: 12px 16px;
    background: rgba(255, 255, 255, 0.08);
    border-radius: 8px;
    transition: background 0.2s;
  }

  #micro-yes-container:hover {
    background: rgba(255, 255, 255, 0.12);
  }

  #micro-yes-checkbox {
    width: 22px;
    height: 22px;
    cursor: pointer;
    accent-color: var(--kw-accent);
  }

  #micro-yes-label {
    cursor: pointer;
  }

  #social-proof {
    position: fixed;
    bottom: 90px;
    left: 50%;
    transform: translateX(-50%);
    max-width: 380px;
    width: 90%;
    background: rgba(255, 255, 255, 0.97);
    backdrop-filter: blur(12px);
    color: #1a1a1a;
    padding: 12px 18px;
    border-radius: 10px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    font-size: 14px;
    z-index: 1500;
    display: none;
    animation: slideUp 0.4s ease-out;
    pointer-events: none;
  }

  #social-proof-content {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 500;
  }

  #social-proof-content::before {
    content: "‚úì";
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: #1DBF8A;
    color: white;
    border-radius: 50%;
    font-weight: bold;
    flex-shrink: 0;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  }

  #scarcity {
    margin-top: 16px;
    background: linear-gradient(135deg, #ff3b3b 0%, #ff6b6b 100%);
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 700;
    box-shadow: 0 6px 16px rgba(255, 59, 59, 0.4);
    display: none;
    animation: urgentPulse 2.5s infinite;
  }

  @keyframes urgentPulse {
    0%, 100% {
      transform: scale(1);
      box-shadow: 0 6px 16px rgba(255, 59, 59, 0.4);
    }
    50% {
      transform: scale(1.02);
      box-shadow: 0 8px 20px rgba(255, 59, 59, 0.5);
    }
  }

  #progress-indicator {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.95);
    color: #333;
    padding: 10px 18px;
    border-radius: 24px;
    font-size: 14px;
    font-weight: 600;
    z-index: 1500;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    display: none;
    pointer-events: none;
  }

  #progress-indicator strong {
    color: var(--kw-accent);
  }

  @media (max-width: 420px) {
    #hl {
      font-size: 34px;
    }
    #sh {
      font-size: 18px;
    }
    #cta {
      width: 100%;
      max-width: 320px;
      font-size: 18px;
      padding: 18px 28px;
    }
    #footer-content {
      flex-direction: column;
      text-align: center;
      gap: 8px;
    }
    #echo-footer {
      font-size: 11px;
      padding: 12px 16px;
    }
    #social-proof {
      bottom: 75px;
      font-size: 14px;
      padding: 12px 16px;
      max-width: calc(100% - 20px);
    }
    #scarcity {
      font-size: 14px;
      padding: 12px 20px;
      margin-top: 14px;
    }
    #progress-indicator {
      top: 10px;
      right: 10px;
      font-size: 13px;
      padding: 8px 14px;
    }
    #micro-yes-container {
      font-size: 15px;
      padding: 12px 14px;
    }
  }
</style>

<div id="echo-root">
  <div id="echo-overlay"></div>

  <!-- Psychological Triggers -->
  <div id="progress-indicator"></div>
  <div id="social-proof"><div id="social-proof-content"></div></div>

  <div id="echo-content">
    <h1 id="hl" data-default="Consistent, Trusted Signals" data-default-color="ffffff">Consistent, Trusted Signals</h1>
    <p id="sh" data-default="Clear rules. Clear trading." data-default-color="ffffff">Clear rules. Clear trading.</p>
    
    <!-- Micro-Yes Checkbox (optional) -->
    <div id="micro-yes-container">
      <input type="checkbox" id="micro-yes-checkbox">
      <label id="micro-yes-label" for="micro-yes-checkbox" data-default="Yes, I want to see live trusted signals">Yes, I want to see live trusted signals</label>
    </div>

    <a id="cta" data-action="book" data-default="View Live Signals" data-default-href="https://calendly.com/killerwhaleventures/complimentary-platform-walkthrough?background_color=0a1f31&text_color=ffffff&primary_color=1dbf8a&month=2026-02" href="https://calendly.com/killerwhaleventures/complimentary-platform-walkthrough?background_color=0a1f31&text_color=ffffff&primary_color=1dbf8a&month=2026-02">View Live Signals</a>
    
    <!-- Scarcity below CTA -->
    <div id="scarcity" data-default="Only {N} demo slots remaining for this month"></div>
    
    <div id="bg" data-default="kwv_5.jpg" style="display:none"></div>
  </div>

  <footer id="echo-footer">
    <div id="footer-content">
      <p id="footer-copyright">¬© 2026 Killer Whale Ventures. All rights reserved.</p>
      <div id="footer-links">
        <a href="https://killerwhaleventures.com/privacy-policy/" target="_blank" rel="noopener noreferrer">Privacy Policy</a>
        <a href="https://killerwhaleventures.com/web-user-agreement/" target="_blank" rel="noopener noreferrer">Terms of Service</a>
        <a href="https://killerwhaleventures.com/cookie-policy/" target="_blank" rel="noopener noreferrer">Cookie Policy</a>
      </div>
    </div>
  </footer>
</div>

<!-- Hidden data for social proof defaults (KWV Customized) -->
<div id="social-proof-data" style="display:none" 
     data-names="Alex,Jordan,Marcus,Sarah,Chris,Taylor"
     data-cities="Boston,NYC,Miami,Dubai,Austin,Seattle,Denver,"
     data-actions="just joined the platform,claimed live signals,started trading,activated trading automation"></div>

<script>
(function () {
  "use strict";

  // ============================================
  // UTILITY: Parse URL Parameters
  // ============================================
  function parseParams(str) {
    str = (str || "").replace(/^[?#]/, "");
    var params = {};
    if (!str) return params;
    str.split("&").forEach(function (pair) {
      var parts = pair.split("=");
      var key = decodeURIComponent(parts[0] || "").trim();
      var val = decodeURIComponent((parts[1] || "").split("+").join(" ")).trim();
      if (key) params[key] = val;
    });
    return params;
  }

  var params = Object.assign({}, parseParams(window.location.search), parseParams(window.location.hash));
  var DEBUG = params.debug === "1";

  // TEST_ALL MODE: Enable all features for quick testing
  if (params.test_all === "1") {
    params.social_proof = "on";
    params.scarcity = params.scarcity || "3";
    params.progress = params.progress || "1";
    params.micro_yes = "on";
    params.btn_size = params.btn_size || "large";
    params.overlay = params.overlay || "medium";
    DEBUG = true;
    console.log("üß™ TEST_ALL MODE ENABLED - All features activated");
  }

  if (DEBUG) console.log("üîç DEBUG MODE ENABLED");
  if (DEBUG) console.log("üìã ALL PARAMS:", params);

  // ============================================
  // ELEMENTS
  // ============================================
  var hlEl = document.getElementById("hl");
  var shEl = document.getElementById("sh");
  var ctaEl = document.getElementById("cta");
  var overlayEl = document.getElementById("echo-overlay");
  var root = document.getElementById("echo-root");

  // ============================================
  // CONTENT REPLACEMENT
  // ============================================
  if (params.hl && hlEl) {
    hlEl.textContent = params.hl;
    if (DEBUG) console.log("‚úÖ Headline:", params.hl);
  }
  if (params.sh && shEl) {
    shEl.textContent = params.sh;
    if (DEBUG) console.log("‚úÖ Subheadline:", params.sh);
  }
  if (params.cta && ctaEl) {
    ctaEl.textContent = params.cta;
    if (DEBUG) console.log("‚úÖ CTA:", params.cta);
  }

  // ============================================
  // FONT FAMILY
  // ============================================
  var fontMap = {
    system: "ui-sans-serif, system-ui, -apple-system, sans-serif",
    roboto: "'Roboto', sans-serif",
    inter: "'Inter', sans-serif",
    poppins: "'Poppins', sans-serif",
    arial: "Arial, Helvetica, sans-serif",
    georgia: "Georgia, 'Times New Roman', serif"
  };
  if (params.font && fontMap[params.font]) {
    document.documentElement.style.setProperty("--kw-font", fontMap[params.font]);
    if (DEBUG) console.log("‚úÖ Font:", params.font);
  }

  // ============================================
  // BUTTON STYLING
  // ============================================
  if (params.btn_color && ctaEl) {
    ctaEl.style.background = "#" + params.btn_color;
    if (DEBUG) console.log("‚úÖ Button Color:", params.btn_color);
  }
  if (params.btn_text && ctaEl) {
    ctaEl.style.color = "#" + params.btn_text;
    if (DEBUG) console.log("‚úÖ Button Text Color:", params.btn_text);
  }

  // Button Size
  var btnSizeMap = {
    small: { padding: "12px 20px", fontSize: "16px" },
    medium: { padding: "16px 26px", fontSize: "18px" },
    large: { padding: "20px 36px", fontSize: "20px" },
    xlarge: { padding: "24px 44px", fontSize: "22px" }
  };
  if (params.btn_size && btnSizeMap[params.btn_size] && ctaEl) {
    ctaEl.style.padding = btnSizeMap[params.btn_size].padding;
    ctaEl.style.fontSize = btnSizeMap[params.btn_size].fontSize;
    if (DEBUG) console.log("‚úÖ Button Size:", params.btn_size);
  }

  // Button Style (border-radius)
  var btnStyleMap = {
    square: "4px",
    rounded: "12px",
    pill: "50px",
    subtle: "8px"
  };
  if (params.btn_style && btnStyleMap[params.btn_style] && ctaEl) {
    ctaEl.style.borderRadius = btnStyleMap[params.btn_style];
    if (DEBUG) console.log("‚úÖ Button Style:", params.btn_style);
  }

  // ============================================
  // TEXT SIZING & COLORS
  // ============================================
  if (params.hl_size && hlEl) {
    hlEl.style.fontSize = params.hl_size + "px";
    if (DEBUG) console.log("‚úÖ Headline Size:", params.hl_size + "px");
  }
  if (params.hl_color && hlEl) {
    hlEl.style.color = "#" + params.hl_color;
    if (DEBUG) console.log("‚úÖ Headline Color:", params.hl_color);
  } else if (hlEl && hlEl.getAttribute("data-default-color")) {
    hlEl.style.color = "#" + hlEl.getAttribute("data-default-color");
  }
  
  if (params.sh_size && shEl) {
    shEl.style.fontSize = params.sh_size + "px";
    if (DEBUG) console.log("‚úÖ Subheadline Size:", params.sh_size + "px");
  }
  if (params.sh_color && shEl) {
    shEl.style.color = "#" + params.sh_color;
    if (DEBUG) console.log("‚úÖ Subheadline Color:", params.sh_color);
  } else if (shEl && shEl.getAttribute("data-default-color")) {
    shEl.style.color = "#" + shEl.getAttribute("data-default-color");
  }

  // ============================================
  // OVERLAY DARKNESS
  // ============================================
  var overlayMap = {
    light: "rgba(0, 0, 0, 0.35)",
    medium: "rgba(0, 0, 0, 0.55)",
    dark: "rgba(0, 0, 0, 0.75)",
    xdark: "rgba(0, 0, 0, 0.85)"
  };
  if (params.overlay && overlayMap[params.overlay] && overlayEl) {
    overlayEl.style.background = overlayMap[params.overlay];
    if (DEBUG) console.log("‚úÖ Overlay:", params.overlay);
  } else if (params.overlay_custom && overlayEl) {
    var opacity = parseFloat(params.overlay_custom);
    if (!isNaN(opacity) && opacity >= 0 && opacity <= 1) {
      overlayEl.style.background = "rgba(0, 0, 0, " + opacity + ")";
      if (DEBUG) console.log("‚úÖ Overlay Custom:", opacity);
    }
  }

  // ============================================
  // SMART BUTTON LINK BUILDER
  // ============================================
  if (ctaEl) {
    var destinationURL = params.link || ctaEl.getAttribute("data-default-href") || ctaEl.href;
    
    if (params.link && !/^https?:\/\//i.test(params.link)) {
      destinationURL = "https://" + params.link;
    }
    
    var urlParts = destinationURL.split("?");
    var baseURL = urlParts[0];
    var existingParams = urlParts[1] || "";
    
    var contentParams = ["hl", "sh", "img", "link", "btn_color", "btn_text", "btn_size", "btn_style", "font", "hl_size", "sh_size", "hl_color", "sh_color", "overlay", "overlay_custom", "social_proof", "social_text", "scarcity", "scarcity_text", "progress", "micro_yes", "micro_text", "debug", "test_all"];
    var trackingParams = [];
    
    // AUTO-ADD CTA
    if (params.cta) {
      trackingParams.push("cta=" + encodeURIComponent(params.cta));
      if (DEBUG) console.log("üîó Auto-match CTA:", params.cta);
    }
    
    // Add all tracking params
    for (var key in params) {
      if (params.hasOwnProperty(key) && contentParams.indexOf(key) === -1 && key !== "cta") {
        trackingParams.push(encodeURIComponent(key) + "=" + encodeURIComponent(params[key]));
      }
    }
    
    var allParams = existingParams ? [existingParams] : [];
    if (trackingParams.length > 0) {
      allParams = allParams.concat(trackingParams);
    }
    
    var finalURL = baseURL + (allParams.length > 0 ? "?" + allParams.join("&") : "");
    ctaEl.href = finalURL;
    
    if (DEBUG) console.log("üîó Final Button Link:", finalURL);
  }

  // ============================================
  // BACKGROUND IMAGE LOADING (with mobile detection)
  // ============================================
  var bgEl = document.getElementById("bg");
  var defaultBg = bgEl ? (bgEl.getAttribute("data-default") || "").trim() : "";
  var chosen = (params.img || defaultBg || "").trim();

  if (chosen) {
    var isMobile = window.innerWidth <= 768;
    
    if (/^https?:\/\//i.test(chosen)) {
      root.style.backgroundImage = 'url("' + chosen + '")';
      if (DEBUG) console.log("üñºÔ∏è BG Set (full URL):", chosen);
    } else {
      chosen = decodeURIComponent(chosen).replace(/^\/+/, "");
      
      var mobileChosen = chosen;
      if (isMobile) {
        var parts = chosen.split(".");
        var ext = parts.pop();
        var base = parts.join(".");
        mobileChosen = base + "_mobile." + ext;
      }
      
      var origin = window.location.origin.replace(/\/+$/, "");
      var candidates = isMobile ? [
        origin + "/public/" + mobileChosen,
        origin + "/" + mobileChosen,
        origin + "/public/" + chosen,
        origin + "/" + chosen
      ] : [
        origin + "/public/" + chosen,
        origin + "/" + chosen
      ];

      function tryLoad(i) {
        if (i >= candidates.length) {
          if (DEBUG) console.log("‚ùå BG Load Failed:", candidates);
          return;
        }
        var url = candidates[i];
        var img = new Image();
        img.onload = function () {
          root.style.backgroundImage = 'url("' + url + '")';
          if (DEBUG) console.log("‚úÖ BG Loaded:", url);
        };
        img.onerror = function () {
          if (DEBUG) console.log("‚ö†Ô∏è BG 404:", url);
          tryLoad(i + 1);
        };
        img.src = url + (url.indexOf("?") === -1 ? "?" : "&") + "v=" + Date.now();
      }

      tryLoad(0);
    }
  }

  // ============================================
  // PSYCHOLOGICAL TRIGGERS
  // ============================================

  // MICRO-YES CHECKBOX
  if (params.micro_yes === "on") {
    var microYesContainer = document.getElementById("micro-yes-container");
    var microYesCheckbox = document.getElementById("micro-yes-checkbox");
    var microYesLabel = document.getElementById("micro-yes-label");
    
    if (microYesContainer && microYesCheckbox && ctaEl) {
      if (params.micro_text) {
        microYesLabel.textContent = params.micro_text;
      } else if (microYesLabel.getAttribute("data-default")) {
        microYesLabel.textContent = microYesLabel.getAttribute("data-default");
      }
      
      microYesContainer.style.display = "flex";
      ctaEl.classList.add("dimmed");
      
      microYesCheckbox.addEventListener("change", function() {
        if (microYesCheckbox.checked) {
          ctaEl.classList.remove("dimmed");
        } else {
          ctaEl.classList.add("dimmed");
        }
      });
      
      if (DEBUG) console.log("‚úÖ Micro-Yes Enabled");
    }
  }

  // SOCIAL PROOF TICKER
  if (params.social_proof === "on") {
    var socialProof = document.getElementById("social-proof");
    var socialProofContent = document.getElementById("social-proof-content");
    var socialProofData = document.getElementById("social-proof-data");
    
    if (socialProof && socialProofContent) {
      if (params.social_text) {
        function showProof() {
          socialProofContent.textContent = params.social_text;
          socialProof.style.display = "block";
          setTimeout(function() {
            socialProof.style.display = "none";
          }, 6000);
        }
        setTimeout(showProof, 2000);
        setInterval(showProof, 12000);
      } else {
        var names = ["Alex", "Jordan", "Marcus", "Sarah", "Chris", "Taylor"];
        var cities = ["Boston", "NYC", "Miami", "Austin", "Seattle", "Denver"];
        var actions = ["just joined the platform", "claimed live signals", "started trading", "activated automation"];
        
        if (socialProofData) {
          var brandNames = socialProofData.getAttribute("data-names");
          var brandCities = socialProofData.getAttribute("data-cities");
          var brandActions = socialProofData.getAttribute("data-actions");
          
          if (brandNames) names = brandNames.split(",");
          if (brandCities) cities = brandCities.split(",");
          if (brandActions) actions = brandActions.split(",");
        }
        
        function showProof() {
          var name = names[Math.floor(Math.random() * names.length)];
          var city = cities[Math.floor(Math.random() * cities.length)];
          var action = actions[Math.floor(Math.random() * actions.length)];
          socialProofContent.textContent = name + " from " + city + " " + action;
          socialProof.style.display = "block";
          
          setTimeout(function() {
            socialProof.style.display = "none";
          }, 6000);
        }
        
        setTimeout(showProof, 2000);
        setInterval(showProof, 12000);
      }
      
      if (DEBUG) console.log("‚úÖ Social Proof Enabled");
    }
  }

  // SCARCITY COUNTER
  if (params.scarcity) {
    var scarcityEl = document.getElementById("scarcity");
    
    if (scarcityEl) {
      if (params.scarcity_text) {
        scarcityEl.innerHTML = '<span>‚ö°</span> ' + params.scarcity_text;
      } else {
        var slots = parseInt(params.scarcity, 10);
        var defaultText = scarcityEl.getAttribute("data-default") || "Only {N} demo slots available today";
        
        if (!isNaN(slots) && slots > 0) {
          scarcityEl.innerHTML = '<span>‚ö°</span> ' + defaultText.replace("{N}", slots);
        }
      }
      scarcityEl.style.display = "block";
      if (DEBUG) console.log("‚úÖ Scarcity Enabled");
    }
  }

  // PROGRESS INDICATOR
  if (params.progress) {
    var progressEl = document.getElementById("progress-indicator");
    var step = parseInt(params.progress, 10);
    
    if (progressEl && !isNaN(step) && step > 0) {
      progressEl.innerHTML = 'Step <strong>' + step + '</strong> of 3';
      progressEl.style.display = "block";
      if (DEBUG) console.log("‚úÖ Progress Enabled: Step", step);
    }
  }

  // ============================================
  // ANALYTICS (GTM/GA4 Auto-Fire)
  // ============================================
  if (typeof window.dataLayer !== "undefined") {
    window.dataLayer.push({
      event: "echo_page_view",
      page_type: "echo_landing",
      test_params: params
    });
    if (DEBUG) console.log("üìä Analytics Event Fired: echo_page_view");
  }

  if (ctaEl) {
    ctaEl.addEventListener("click", function() {
      if (typeof window.dataLayer !== "undefined") {
        window.dataLayer.push({
          event: "echo_cta_click",
          cta_text: ctaEl.textContent,
          destination: ctaEl.href
        });
        if (DEBUG) console.log("üìä Analytics Event Fired: echo_cta_click");
      }
    });
  }

  if (DEBUG) console.log("‚úÖ Master Template Loaded Successfully");
})();
</script>
